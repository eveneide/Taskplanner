<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Document</title>
 <link rel= "stylesheet" href= "css/stylesheet.css">
 <link rel="shortcut icon" href="#">
</head>
<body>

    <div id= "header"><h1>Create Task </h1></div>

    <hr>
    <div>
    <form id= "taskForm">

        <label for="inpEmail">Title: </label>
        <input id= "inpTitle" type="text" placeholder= "Tittel" value= "Tittel">

        <label for="inpTask">Task:</label>
        <textarea id="inpTask">Write a task</textarea>
        <input type="submit" value= "Add Task">

    </form>
    </div>
    <p id= "tilbakeMelding"></p>





<script>

    //const database = require("./modules/datahandler")

    let url = "https://task-lamalama.herokuapp.com/task/"
    const database = require("./datahandler")


    let taskForm = document.getElementById('taskForm');
    let inpTitle = document.getElementById('inpTitle');
    let inpTask = document.getElementById('inpTask');
    let tilbakeMelding = document.getElementById('tilbakeMelding');

    let loginDataJson = localStorage.getItem("logindata"); //hvis vi vil hente lokaldata i json
    let loginData = JSON.parse(loginDataJson); //hente lokal data, convertere fra json

    let title = "title test";
    let tId =  "task id";

    taskForm.addEventListener('submit', async function(evt){

        evt.preventDefault();

        let fdata = {
            title: inpTitle.value,
            msg: inpTask
        }

        let cfg = {
            method: "POST",
            headers: {// create task. token hente fra database, antageligvis credentials i databasemodul. 
                "content-type" : "application/json",
                "authorization" : credentials
            },
            body: JSON.stringify(fdata)

        }

        try {

            
            let response = await fetch(url,cfg);
            let data = await response.json();

            location.href = "task_list.html"; //fjern hvis add task blir popup

        }
        catch (err){
            tilbakeMelding.innerHTML = "Noe gikk galt";
        }
        

    });

    class Task {

constructor(task_id, task_title, owner) {
    this.task_id = task_id;
    this.task_title = task_title;
    this.owner = owner;
}

async create() {
    try {
        let resp = await database.(this.task_id, this.task_title, this.owner);
        return resp;
    } catch (error) {
        console.error(error)
    }
}

async getTaskDataFromDb() {
    try {
        let resp = await database.getTaskDataFromDb(this.owner, this.id);
        return resp;
    } catch (error) {
        console.error(error)
    }
}

async update() {
    try {
        let resp = await database.updateTask(this.name);
        return resp;
    } catch (err) {
        console.log(err);
    }
}

async delete() {
    try {
        let resp = await database.deleteTask(this.name);
        return resp;
    } catch (err) {
        console.log(err);
    }
}

}


module.exports = Task;



    
</script>

</body>
</html>
